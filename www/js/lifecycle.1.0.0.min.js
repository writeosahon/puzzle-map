/*!
 * Lifecycle.js v1.0.0
 * https://github.com/fengyuanchen/lifecycle.js
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2018-05-20T07:03:28.154Z
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Lifecycle=e()}(this,function(){"use strict";var o={autoStart:!1,autoEmit:!1,autoEnd:!1},e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function f(t){return"string"==typeof t}function s(t){return"object"===(void 0===t?"undefined":e(t))&&null!==t}var i=Object.prototype.hasOwnProperty;function c(t){if(!s(t))return!1;try{var e=t.constructor,n=e.prototype;return e&&n&&i.call(n,"isPrototypeOf")}catch(t){return!1}}function u(t){return"function"==typeof t}var h=Object.assign||function(n){for(var t=arguments.length,e=Array(1<t?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];return s(n)&&0<e.length&&e.forEach(function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})}),n},t=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();var l=/\s\s*/g,y="lifecycle";return function(){function r(t,e,n){var i=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),!s(t))throw new Error("Invalid "+y+" target: "+t);if(this.target=t,this.active=!1,this.hooks={},c(e))this.stages=Object.keys(e),this.on(e);else{if(!Array.isArray(e))throw new Error("Invalid "+y+" stages: "+e);this.stages=e}this.options=h({},o,n),this.minIndex=0,this.maxIndex=Math.max(this.minIndex,this.stages.length-1),this.stage="",Object.defineProperty(this,"index",{get:function(){return i.stages.indexOf(i.stage)},set:function(t){if(i.active&&t!==i.index){var e=i.stages[t];e&&(i.stage=e,i.options.autoEmit&&i.emit(e),t>=i.maxIndex&&i.options.autoEnd&&i.end())}}}),this.options.autoStart&&this.start()}return t(r,[{key:"start",value:function(){return this.active||(this.active=!0,this.index=0),this}},{key:"end",value:function(){return this.active&&(this.index=this.maxIndex,this.active=!1),this}},{key:"prev",value:function(){return this.active&&this.index>this.minIndex&&(this.index-=1),this}},{key:"next",value:function(){return this.active&&this.index<this.maxIndex&&(this.index+=1),this}},{key:"goto",value:function(t){if(this.active&&t){var e=this.stages.indexOf(t);0<=e&&e<=this.maxIndex&&(this.index=e)}return this}},{key:"on",value:function(e,t){var o=this,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{once:!1,prepend:!1},n=[];if(f(e))n=e.trim().split(l);else{if(!Array.isArray(e)){if(c(e))return c(t)&&(s=t),Object.keys(e).forEach(function(t){o.on(t,e[t],s)}),this;throw new Error("Invalid "+y+" stage type: "+e)}n=n.concat(e)}var a=[];if(u(t))a.push(t);else{if(!Array.isArray(t))throw new Error("Invalid "+y+" stage hook: "+t);a=t}return n.forEach(function(n){if(n){var i=o.hooks[n],r=h({once:!1,prepend:!1},s);i?a.reverse().forEach(function(e){if(u(e)){i.slice().forEach(function(t){t.hook===e&&i.splice(i.indexOf(t),1)});var t={type:n,hook:e,options:r};r.prepend?i.unshift(t):i.push(t)}}):o.hooks[n]=a.map(function(t){return{type:n,hook:t,options:r}})}}),this}},{key:"once",value:function(t,e,n){return this.on(t,e,h({},n,{once:!0}))}},{key:"off",value:function(e,t){var n=this,i=[];if(f(e))i=e.trim().split(l);else if(Array.isArray(e))i=i.concat(e);else if(c(e))return Object.keys(e).forEach(function(t){n.off(t,e[t])}),this;if(0<i.length){var r=[];u(t)?r.push(t):Array.isArray(t)&&(r=t),i.forEach(function(t){var i=n.hooks[t];i&&(0<r.length?r.forEach(function(n){u(n)&&i.forEach(function(t,e){t.hook===n&&i.splice(e,1)})}):delete n.hooks[t])})}else this.hooks={};return this}},{key:"emit",value:function(){for(var r=this,t=arguments.length,o=Array(1<t?t-1:0),e=1;e<t;e++)o[e-1]=arguments[e];var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.stage,i=[];if(this.active&&n){var s=[];f(n)?s=n.trim().split(l):Array.isArray(n)&&(s=s.concat(n)),0<s.length&&(i=s.map(function(t){var i=r.hooks[t],e=void 0;return i&&(e=i.map(function(t,e){var n=t.hook;return t.options.once&&i.splice(e,1),n.apply(r.target,o)})),e}))}return 1<i.length?i:i[0]}},{key:"is",value:function(t){return this.stage===t}}]),r}()});